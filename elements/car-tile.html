<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">

<polymer-element name="car-tile" >
  <template>
    <style shim-shadowdom>


      neon-animated-pages {
        height: 100%;
      }

      #showing {
        z-index: 5000;
        background-color: #fff;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        position: fixed;
        overflow: scroll;
      }

      .showing-inner {
        min-height: 100vh;
        width: 100%;
      }

      #quote {
        z-index: 5000;
        background-color: #fff;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        position: fixed;
      }
      #showing h1, #showing h3 {
        color: #222;
      }

      #listing h2, #listing h3 {
        color: #222;
      }

      #listing h3 {
        text-transform: uppercase;
        font-size: 14px;
        font-weight: lighter;
        color: #999;
      }

      #card {
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
        margin: 10px;
      }

      .close {
        position: fixed;
        top: 10px;
        left: 20px;
        font-size: 32px;
        color: white;
        cursor: pointer;
        padding: 10px;
      }

      .big-image {
        height: 50vh;
        width: 100%;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
      }

      .big-image-height-shim {
        
      }

      .quote-form {
        padding-left: 1em;
        padding-right: 1em;
        min-width: 20em;
        text-align: left;
        margin: auto;
      }

      .quote-form .close {
        color: #222;
      }

      .quote-form paper-fab {
        margin-top: 2em;
      }

      #thanks {
        background-color: #22dd66;
        text-align: center;
      }

      #thanks h3 {
        color: white;
        text-align: center;
      }

      .thanks-message {
        width: 100%;
        margin: auto;
      }

      paper-button {
        background-color: white;
        padding: 1em;
      }

      #listing {
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        position: absolute;
        z-index: 2;
      }

      #listing h2 {
        text-decoration: underline;
      }

      /*.overlay {
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        background-color: rgba(64,64,64,0.5);
        position: absolute;
        z-index: 1;
        -webkit-transition:background-color 0.5s ease-in; 
        -moz-transition:background-color 0.5s ease-in; 
        -o-transition:background-color 0.5s ease-in; 
        transition:background-color 0.5s ease-in;
      }*/

      #card:hover .overlay {
        background-color: rgba(255,255,255,0.5);
      }

      .deal {
        line-height: 150%;
      }

      .deal .was{
        opacity: 0.4;
        color: #999;
        background-color: #ddd;
        text-transform: uppercase;

        -webkit-border-top-right-radius: 8px;
        -webkit-border-bottom-right-radius: 8px;
        -moz-border-radius-topright: 8px;
        -moz-border-radius-bottomright: 8px;
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
      }

      .deal .was .price {
        text-decoration: line-through;
        color: #999;
      }

      .deal {
        font-weight: lighter;
      }

      .deal .now {
        color: #aaa;
        background-color: #222;
        text-transform: uppercase;

        -webkit-border-top-left-radius: 8px;
        -webkit-border-bottom-left-radius: 8px;
        -moz-border-radius-topleft: 8px;
        -moz-border-radius-bottomleft: 8px;
        border-top-left-radius: 8px;
        border-bottom-left-radius: 8px;
      }

      .deal .now .price {
        color: white;
      }

      .ts-and-cs {
        max-width: 36em;
        margin: auto;
        padding-left: 1em;
        padding-right: 1em;
        text-align: left;
        border-top: 1px solid #222;
        padding-top: 2em;
        margin-top: 2em;
      }

      .quote-button paper-button {
        position: relative;
        top: 50px;
      }

      paper-button.request-quote {
        background-color: #222;
        color: white;
        margin-top: 2em;
      }

      .info {
        padding-top: 2em;
        padding-bottom: 8em;
      }

      h2.was {
        text-decoration: line-through;
        color: #aaa;
        font-weight: light;
      }

      .cta-button {
        display: inline-block;
        height: 38px;
        padding: 0 30px;
        color: #555;
        text-align: center;
        font-size: 11px;
        font-weight: 600;
        line-height: 38px;
        letter-spacing: .1rem;
        text-transform: uppercase;
        text-decoration: none;
        white-space: nowrap;
        background-color: transparent;
        border-radius: 4px;
        border: 1px solid #bbb;
        cursor: pointer;
        box-sizing: border-box;
        text-transform: none;
        font-size: 1.2em;
        width: 100%;
        height: auto;
        line-height: 4em;
        background: #FFB943;
        color: #956513;
        border: none;
      }

      .price-description {
        font-weight: lighter;
        font-size: 75%;
      }

      .price {
        font-weight: bold;
      }

      .car-thumb {
        width: 100%;
      }

      .car-thumb-display {
        padding-bottom: 1em;
      }

      .make-and-model {
        padding-bottom: 2em;
      }

      .info-thumb {
        padding: 2em;
      }
      .info-thumb img {
        width: 100%;
      }

      .info {
        margin: auto;
        max-width: 980px;
      }

      .info-title {
        text-align: left;
      }

      .info-make, .info-meta {
        font-size: 16px;
        text-transform: uppercase;
        font-weight: lighter;
        color: #666;
      }

    </style>

    <iron-a11y-keys
          id="keys"
          keys="esc"
          target="[[target]]"
          on-keys-pressed="_escPressed">
        </iron-a11y-keys>

    <neon-animated-pages selected="{{page}}" class="flex layout horizontal self-center" transition="cross-fade" entry-animation="fade-in-animation" exit-animation="fade-out-animation">

      <div id="card" class="layout horizontal flex" on-tap="show">
        <div id="listing" class="layout vertical flex">
          <div class="deal layout horizontal">
            <div class="flex now">
              <div class="price-description">with sharing</div>
              <div class="price">£<span>{{discounted_price}}</span></div>
            </div>
            <div class="flex was">
              <div class="price-description">without</div>
              <div class="price">£<span>{{price}}</span></div>
            </div>
          </div>

          <div class="car-thumb-display flex">
            <img class="car-thumb" src$="[[imga]]">
          </div>

          <div class="make-and-model flex-4 flex centered self-center">
            <h3>{{make}}</h3>
            <h2>{{model}}</h2>
            <h3>{{meta}}</h3>
          </div>

        </div>
        <div class="overlay"></div>
      </div>
      <div id="showing">
        <div class="showing-inner layout vertical flex">
          <div class="big-image layout vertical" style$="{{background(img)}}">
            <div class="close" on-tap="hide">&times;</div>
            <div class="self-center flex flex-5">
            </div>
            <div class="quote-button self-center flex-1 flex">
              <!--<paper-button raised on-tap="quote">Request a quote</paper-button>-->
            </div>
          </div>
          <div class="info centered self-center flex layout horizontal">
            <div class="info-thumb flex flex-1">
              <img src$="{{imga}}">
            </div>
            <div class="flex flex-2">
              <div class="layout horizontal">
                <div class="flex info-title">
                  <h3 class="info-make">{{make}}</h3>
                  <h2 class="info-model">{{model}}</h2>
                  <h3 class="info-meta">{{meta}}</h3>
                </div>

                <div class="deal layout horizontal flex">
                  <div class="flex now self-center">
                    <div class="price-description">with sharing</div>
                    <div class="price">£<span>{{discounted_price}}</span></div>
                  </div>
                  <div class="flex was self-center">
                    <div class="price-description">without</div>
                    <div class="price">£<span>{{price}}</span></div>
                  </div>
                </div>
              </div>
              
              <a class="cta-button" on-click="quote">Get a quote now</a>

              <p>Based on lending the car</p>
              <h2><span>{{shares}}</span>&times; per month</h2>

              <paper-slider id="sharesSlider" class="red" value="{{shares}}" min="0" max="20" editable></paper-slider>

              
              <div class="ts-and-cs">
                <p>3 months deposit and 36 monthly payments.</p>
                <p>Lending your vehicle to a friend or relative requires either party to use our mobile app which covers the borrower with fully comprehensive insurance and automatically reduces your monthly direct debit.</p>
                <p>You are liable for the full monthly amount should you not lend your car within a calendar month. We use a third party credit check to ensure affordability.</p>
              </div>
            </div>
          </div>
          <div class="centered self-center flex layout horizontal">
            <div class="self-center flex">
              
            </div>
          </div>
        </div>
      </div>
      <div id="quote" class="layout horizontal flex">
        <div class="quote-form centered self-center">
          <div class="close" on-tap="hide">&times;</div>
          <h1>Request a quote</h1>
          <paper-input value="{{email}}" label="Your email"></paper-input>
          <paper-input value="{{first_name}}" label="First name"></paper-input>
          <paper-input value="{{last_name}}" label="Last name"></paper-input>
          <paper-input value="{{postcode}}" label="Post code"></paper-input>
          <paper-fab raised on-tap="submit" icon="arrow-forward" ></paper-fab>
        </div>
      </div>
      <div id="thanks" class="layout horizontal flex">
        <div class="thanks-message centered self-center">
          <h3>Thanks!<br />We’ll be in touch</h3>
        </div>
      </div>
    </neon-animated-pages>
      
  </template>
  <script>
    Polymer({
      is: "car-tile",
      behaviors: [
        Polymer.IronA11yKeysBehavior
      ],

      keyBindings: {
        'esc': '_updatePressed'
      },

      properties: {
        page: {
          type: Number,
          value: 0
        },
        discounted_price: {
          type: Number,
          computed: 'discounted(price,shares)'
        },
        meta: String,
        make: String,
        model: String,
        monthly: Number,
        discount: Number,
        engine: Number,
        doors: Number,
        description: String,
        img: String,
        imga: {
          type: String,
          value: "hello"
        },
        first_name: {
          type: String,
          value: "",
          notify: true
        },
        last_name: {
          type: String,
          value: "",
          notify: true
        },
        email: {
          type: String,
          value: "",
          notify: true
        },
        postcode: {
          type: String,
          notify: true
        },
        shares: {
          type: Number,
          value: 0,
          notify: true
        },
        target: {
          type: Object,
          value: function() {
            return document.body;
          }
        }
      },
      background: function(img) {
        return("background-image: url('" + img + "');");
      },
      show: function() {
        console.log("show");
        analytics.track('show', {make: this.make, model: this.model, meta: this.meta, price: this.price, discounted_price: this.discounted_price});
        this.page = 1;
      },
      hide: function() {
        analytics.track('hide');
        this.page = 0;
      },
      quote: function() {
        if(this.email == null || this.email == "") {
          analytics.track('quote form');
          this.page = 2;
        } else {
          this.trackQuote();
        }
      },
      submit: function() {
        analytics.identify({email: this.email, first_name: this.first_name, last_name: this.last_name, postcode: this.postcode});
        this.trackQuote();
      },
      trackQuote: function() {
        analytics.track('quote', {make: this.make, model: this.model, meta: this.meta,price: this.price, discounted_price: this.discounted_price});
        this.page = 3;
        var ctx = this;
        setTimeout(function() {
          ctx.hide();
        },2000);
      },
      _escPressed: function(event) {
        analytics.track('hide');
        this.page = 0;
      },
      discounted: function(price, shares) {
        return(Math.floor((30 - shares) * (price / 30.0 )));
      },
      ready: function() {
        console.log("car-tile", this.make, this.imga, this.img);
      }
    });
  </script>
</polymer-element>