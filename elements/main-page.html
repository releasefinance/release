<link rel="import" href="./release-animated-page.html">
<link rel="import" href="./car-tile.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<dom-module id="main-page">
  <style>
    .body-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
      z-index: -1;
      background: #ffffff; /* Old browsers */
      background: -moz-linear-gradient(top,  #ffffff 0%, #f5f5f5 100%); /* FF3.6+ */
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#f5f5f5)); /* Chrome,Safari4+ */
      background: -webkit-linear-gradient(top,  #ffffff 0%,#f5f5f5 100%); /* Chrome10+,Safari5.1+ */
      background: -o-linear-gradient(top,  #ffffff 0%,#f5f5f5 100%); /* Opera 11.10+ */
      background: -ms-linear-gradient(top,  #ffffff 0%,#f5f5f5 100%); /* IE10+ */
      background: linear-gradient(to bottom,  #ffffff 0%,#f5f5f5 100%); /* W3C */
      filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#f5f5f5',GradientType=0 ); /* IE6-9 */

    }
    #cars {
      flex-wrap: flex;
      text-align: center;
      margin-bottom: 80px;
      margin-top: 60px;
      width: 100%;
    }

    #sticky-footer {
      position: fixed;
      bottom: 0px;
      left: 0px;
      width: 100%;
      background-color: #555;
      z-index: 2000;
      padding-bottom: 1em;
      padding-top: 1em;
      border-top: 1px solid #222;
      background: #343434;
    }

    car-tile {
      height: 420px;
      width: 32.6%;
      min-width: 200px;
      margin: 1px;
      display: inline-block;
      cursor: pointer;
    }

    @media (max-width: 800px) {
      car-tile {
        width: 100%;
      }
    }

    .deal {
      padding-bottom: 1em;
    }

    .now,
    .was {
      padding: 5px 0;
    }

    .centered {
      text-align: center;
    }
    .car-shim {
      margin-bottom: 10em;
    }

    #budgetSlider paper-input {
      display: none;
    }

    #sharesSlider paper-input {
      display: none;
    }

    .number-display {
      font-weight: bold;
      color: #222;
      background-color: white;
      padding-left: 1em;
      padding-right: 1em;
      padding-top: 0.5em;
      padding-bottom: 0.5em;
      -webkit-border-radius: 8px;
      -moz-border-radius: 8px;
      border-radius: 8px;
      width: auto;
      margin: auto;
      display: inline-block;
    }

    #sticky-footer paper-slider /deep/ #sliderKnobInner.paper-slider {
      background-color: #FFB943;
    }

    #sticky-footer paper-slider.paper-slider-0:not([disabled]) /deep/ #sliderBar.paper-slider #activeProgress.paper-progress {
      background-color: #FFB943;
    }

    #sticky-footer paper-slider /deep/ paper-input {
      display: none;
    }

    #sticky-footer paper-slider {
      width: 100%;
      background: #343434;
    }

    .results-intro {
      margin-top: 80px;
      text-align: left;
      margin-bottom: 40px;
    }

    .hidden {
      display: none;
    }

    .your-available {
      margin-left: 0.5em;
    }
  </style>
  <template>
    <div class="results-intro">

      <h2 class="your-available">Your available cars</h2>


    </div>
    <div id="cars" class="container self-center">
      <div class="centered self-center">
        <template id="carList" is="dom-repeat" items="[[cars]]" filter="inRange">
          <car-tile car="[[item]]" email="{{email}}" budget="[[budget]]" shares="{{shares}}"></car-tile>
        </template>
        <div class="car-shim">&nbsp;</div>
      </div>
    </div>
    <div id="sticky-footer" class="layout horizontal">
      <div class="flex self-centered centered">
        <div>
          <div class="number-display">£<span>{{budget}}</span></div>
        </div>
        <paper-slider id="budgetSlider" class="red" value="{{budget}}" min="250" max="1400" step="50" editable></paper-slider>

      </div>
      <div class="flex self-centered centered">
        <div>
          <div class="number-display"><span>{{shares}}</span> days</div>
        </div>
        <paper-slider id="sharesSlider" class="red" value="{{shares}}" min="0" max="20" editable></paper-slider>
      </div>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: "main-page",
    properties: {
      budget: {
        type: Number,
        //notify: true,
        observer: 'budgetUpdated'
      },
      shares: {
        type: Number,
        //notify: true,
        value: 0,
        observer: 'sharesUpdated'
      },
      cars: Object,
      email: {
        type: String,
        notify: true
      },
      first_name: {
        type: String,
        notify: true
      },
      last_name: {
        type: String,
        notify: true
      },
      postcode: {
        type: String,
        notify: true
      }
    },

    budgetUpdated: function() {
      this.$.carList.render();
      analytics.track('budget', {budget: this.budget});
    },

    sharesUpdated: function() {
      analytics.track('shares', {shares: this.shares});
    },

    displayPrice: function(budget) {
      if(budget) {
        return('£' + (parseInt(budget)));
      } else {
        return('£0');
      }
    },

    ready: function() {
      window.main = this;
    },

    inRange: function(item) {
      return((item.price < (this.budget *1.1)) && (item.price > (this.budget * 0.9)));
    },

    visibleClass: function(item,budget) {
      var visible = ((item.price < (budget * 1.1)) && (item.price > (budget * 0.9)));
      if(visible) {
        return "visible";
      } else {
        return "hidden";
      }
    }
  });

</script>
