<link rel="import" href="./release-animated-page.html">
<link rel="import" href="./car-tile.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<polymer-element name="main-page" extends="release-animated-page">
  <template>
    <style>
      #cars {
        flex-wrap: flex;
        text-align: center;
        margin-bottom: 80px;
        margin-top: 60px;
      }

      #sticky-footer {
        position: fixed;
        bottom: 0px;
        left: 0px;
        width: 100%;
        background-color: #555;
        z-index: 2000;
        padding-bottom: 1em;
        padding-top: 1em;
        border-top: 1px solid #222;
      }

      car-tile {
        height: 360px;
        width: 300px;
        min-width: 200px;
        margin: 1px;
        display: inline-block;
        cursor: pointer;
      }

      .deal {
        padding-bottom: 1em;
      }

      .centered {
        text-align: center;
      }
      .car-shim {
        margin-bottom: 10em;
      }

      #budgetSlider paper-input {
        display: none;
      }

      #sharesSlider paper-input {
        display: none;
      }

      .number-display {
        font-weight: bold;
        color: #222;
        background-color: white;
        padding-left: 1em;
        padding-right: 1em;
        padding-top: 0.5em;
        padding-bottom: 0.5em;
        -webkit-border-radius: 8px;
        -moz-border-radius: 8px;
        border-radius: 8px;
        width: auto;
        margin: auto;
        display: inline-block;
      }

      #sticky-footer paper-slider #sliderKnobInner.paper-slider {
        background-color: #FFB943;
      }

      #sticky-footer paper-slider.paper-slider-0:not([disabled]) #sliderBar.paper-slider #activeProgress.paper-progress {
        background-color: #FFB943;
      } 

      #sticky-footer paper-slider {
        width: 100%;
      }

      .hidden {
        display: none;
      }
    </style>
    <div id="cars" class="container self-center">
      <div class="centered self-center">
        <template id="carList" is="dom-repeat" items="[[cars]]">
          <car-tile car="[[item]]" email="{{email}}" budget="[[budget]]" shares="{{shares}}" class$="[[visibleClass(item,budget)]]"></car-tile>
        </template>
        <div class="car-shim">&nbsp;</div>
      </div>
    </div>
    <div id="sticky-footer" class="layout horizontal">
      <div class="flex self-centered centered">
        <div>
          <div class="number-display">£<span>{{budget}}</span></div>
        </div>
        <paper-slider id="budgetSlider" class="red" value="{{budget}}" min="200" max="2000" step="50" editable></paper-slider>

      </div>
      <div class="flex self-centered centered">
        <div>
          <div class="number-display"><span>{{shares}}</span> shares</div>
        </div>
        <paper-slider id="sharesSlider" class="red" value="{{shares}}" min="0" max="20" editable></paper-slider>
      </div>
    </div>

  </template>
  <script>
    Polymer({
      is: "main-page",
      properties: {
        budget: {
          type: Number,
          //notify: true,
          observer: 'budgetUpdated'
        },
        shares: {
          type: Number,
          //notify: true,
          value: 2,
          observer: 'sharesUpdated'
        },
        cars: Object,
        email: {
          type: String,
          notify: true
        },
        first_name: {
          type: String,
          notify: true
        },
        last_name: {
          type: String,
          notify: true
        },
        postcode: {
          type: String,
          notify: true
        }
      },
      
      budgetUpdated: function() {
        this.$.carList.render();
        analytics.track('budget', {budget: this.budget});
      },
      
      sharesUpdated: function() {
        analytics.track('shares', {shares: this.shares});
      },

      displayPrice: function(budget) {
        if(budget) {
          return('£' + (parseInt(budget)));
        } else {
          return('£0');
        }
      },

      ready: function() {
        window.main = this;
      },

      inRange: function(item) {
        return((item.price < (this.budget + 100)) && (item.price > (this.budget - 100)));
      },

      visibleClass: function(item,budget) {
        var visible = ((item.price < (budget * 1.1)) && (item.price > (budget * 0.9)));
        if(visible) {
          return "visible";
        } else {
          return "hidden";
        }
      }
    });

  </script>
</polymer-element>
